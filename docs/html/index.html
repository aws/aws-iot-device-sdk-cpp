<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AWS IoT C++ SDK: New Version Available</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AWS IoT C++ SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">New Version Available </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_README"></a> A new AWS IoT Device SDK is <a href="https://github.com/awslabs/aws-iot-device-sdk-cpp-v2">now available</a>. It is a complete rework, built to improve reliability, performance, and security. We invite your feedback!</p>
<p >This SDK will no longer receive feature updates, but will receive security updates.</p>
<h1><a class="anchor" id="autotoc_md61"></a>
AWS IoT C++ Device SDK</h1>
<ul>
<li><a class="el" href="index.html#overview">Overview</a></li>
<li><a class="el" href="index.html#features">Features</a></li>
<li><a class="el" href="index.html#design">Design Goals</a></li>
<li><a class="el" href="index.html#metrics">Collection of Metrics</a></li>
<li><a class="el" href="index.html#getstarted">Getting Started</a></li>
<li><a class="el" href="index.html#installation">Installation</a></li>
<li><a class="el" href="index.html#porting">Porting to different platforms</a></li>
<li><a class="el" href="index.html#quicklinks">Quick Links</a></li>
<li><a class="el" href="index.html#sampleapis">Sample APIs</a></li>
<li><a class="el" href="index.html#license">License</a></li>
<li><a class="el" href="index.html#support">Support</a></li>
</ul>
<p ><a class="anchor" id="overview"></a> </p>
<h1><a class="anchor" id="autotoc_md62"></a>
Overview</h1>
<p >This document provides information about the AWS IoT device SDK for C++.</p>
<p ><a class="anchor" id="features"></a> </p>
<h1><a class="anchor" id="autotoc_md63"></a>
Features</h1>
<p >The Device SDK simplifies access to the Pub/Sub functionality of the AWS IoT broker via MQTT and provides APIs to interact with Thing Shadows. The SDK has been tested to work with the AWS IoT platform to ensure best interoperability of a device with the AWS IoT platform.</p>
<h2><a class="anchor" id="autotoc_md64"></a>
MQTT Connection</h2>
<p >The Device SDK provides functionality to create and maintain a MQTT Connection. It expects to be provided with a Network Connection class that connects and authenticates to AWS IoT using either direct TLS or WebSocket over TLS. This connection is used for any further publish operations. It also allows for subscribing to MQTT topics which will call a configurable callback function when these messages are received on these topics.</p>
<h2><a class="anchor" id="autotoc_md65"></a>
Thing Shadow</h2>
<p >This SDK implements the specific protocol for Thing Shadows to retrieve, update and delete Thing Shadows adhering to the protocol that is implemented to ensure correct versioning and support for client tokens. It abstracts the necessary MQTT topic subscriptions by automatically subscribing to and unsubscribing from the reserved topics as needed for each API call. Inbound state change requests are automatically signalled via a configurable callback.</p>
<h2><a class="anchor" id="autotoc_md66"></a>
Jobs</h2>
<p >This SDK also implements the Jobs protocol to interact with the AWS IoT Jobs service. The IoT Job service manages deployment of IoT fleet wide tasks such as device software/firmware deployments and updates, rotation of security certificates, device reboots, and custom device specific management tasks. For additional information please see the <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-jobs.html">Jobs developer guide</a>.</p>
<p ><a class="anchor" id="design"></a> </p>
<h1><a class="anchor" id="autotoc_md67"></a>
Design Goals of this SDK</h1>
<p >The C++ SDK was specifically designed for devices that are not resource constrained and required advanced features such as Message queueing, multi-threading support and the latest language features</p>
<p >Primary aspects are:</p><ul>
<li>Designed around the C++11 standard</li>
<li>Platform neutral, as long as the included CMake can find a C++11 compatible compiler and threading library</li>
<li>Network layer abstracted from the SDK. Can use any TLS library and initialization method</li>
<li>Support for multiple platforms and compilers. Tested on Linux, Windows (with VS2015) and Mac OS</li>
<li>Flexibility in picking and choosing functionality, can create Clients which only perform a subset of MQTT operations</li>
<li>Support for Rapidjson allowing use of complex shadow document structures</li>
</ul>
<p ><a class="anchor" id="metrics"></a> </p>
<h1><a class="anchor" id="autotoc_md68"></a>
Collection of Metrics</h1>
<p >Beginning with Release v1.2.0 of the SDK, AWS collects usage metrics indicating which language and version of the SDK is being used. This allows us to prioritize our resources towards addressing issues faster in SDKs that see the most and is an important data point. However, we do understand that not all customers would want to report this data by default. In that case, the sending of usage metrics can be easily disabled by the user by using the overloaded Connect action which takes in a boolean for enabling or disabling the SDK metrics: </p><div class="fragment"><div class="line">p_iot_client_-&gt;Connect(ConfigCommon::mqtt_command_timeout_, ConfigCommon::is_clean_session_,</div>
<div class="line">                                        mqtt::Version::MQTT_3_1_1, ConfigCommon::keep_alive_timeout_secs_,</div>
<div class="line">                                        std::move(client_id), nullptr, nullptr, nullptr, false); // false for disabling metrics</div>
</div><!-- fragment --><p ><a class="anchor" id="getstarted"></a> </p>
<h1><a class="anchor" id="autotoc_md69"></a>
How to get started ?</h1>
<p >Ensure you understand the AWS IoT platform and create the necessary certificates and policies. For more information on the AWS IoT platform please visit the <a href="http://docs.aws.amazon.com/iot/latest/developerguide/iot-security-identity.html">AWS IoT developer guide</a>.</p>
<p ><a class="anchor" id="installation"></a> </p>
<h1><a class="anchor" id="autotoc_md70"></a>
Installation</h1>
<p >This section explains the individual steps to retrieve the necessary files and be able to build your first application using the AWS IoT C++ SDK. The SDK uses CMake to generate the necessary Makefile. CMake version 3.2 and above is required.</p>
<p >Prerequisites:</p>
<ul>
<li>Make sure to have latest CMake installed. Minimum required version is 3.2</li>
<li>Compiler should support C++11 features. We have tested this SDK with gcc 5+, clang 3.8 and on Visual Studio 2015.</li>
<li>OpenSSL has version 1.1.0 and libssl-dev has version 1.1.0.</li>
<li>You can find basic information on how to set up the above on some popular platforms in <a href="https://github.com/aws/aws-iot-device-sdk-cpp/blob/master/Platform.md">Platform.md</a></li>
</ul>
<p >Build Targets:</p>
<ul>
<li>The SDK itself builds as a library by default. All the samples/tests link to the library. The library target is <code>aws-iot-sdk-cpp</code></li>
<li>Unit tests - <code>aws-iot-unit-tests</code></li>
<li>Integration tests - <code>aws-iot-integration-tests</code></li>
<li>Sample - <code>pub-sub-sample</code></li>
<li>Sample - <code>shadow-delta-sample</code></li>
</ul>
<p >This following sample targets are generated only if OpenSSL is being used:</p><ul>
<li>Sample - <code>discovery-sample</code>.</li>
<li>Sample - <code>robot-arm-sample</code>.</li>
<li>Sample - <code>switch-sample</code></li>
</ul>
<p >Steps:</p>
<ul>
<li>Clone the SDK from the github repository</li>
<li>Change to the repository folder. Create a folder called <code>build</code> to hold the build files and change to this folder. In-source builds are NOT allowed</li>
<li>Run <code>cmake ../.</code> to build the SDK with the CLI.</li>
<li>The command will download required third party libraries automatically and generate a Makefile</li>
<li>Type <code>make &lt;target name&gt;</code> to build the desired target. It will create a folder called <code>bin</code> that will have the build output</li>
</ul>
<p ><a class="anchor" id="porting"></a> </p>
<h1><a class="anchor" id="autotoc_md71"></a>
Porting to different platforms</h1>
<p >The SDK has been written to adhere to C++11 standard without any additional compiler specific features enabled. It should compile on any platform that has a modern C++11 enabled compiler without issue. The platform should be able to provide a C++11 compatible threading implementation (eg. pthread on linux). TLS libraries can be added by simply implementing a derived class of NetworkConnection and providing an instance to the Client. We provide the following reference implementations for the Network layer:</p>
<ul>
<li>OpenSSL - MQTT over TLS using OpenSSL v1.1.0. Tested on Windows (VS 2015) and Linux<ul>
<li>The provided implementation requires OpenSSL to be pre-installed on the device</li>
<li>Use the mqtt port setting from the config file while setting up the network instance</li>
</ul>
</li>
<li>MbedTLS - MQTT over TLS using MbedTLS. Tested on Linux<ul>
<li>The provided implementation will download MbedTLS v2.3.0 from the github repo and build and link to the libraries. Please be warned that the default configuration of MbedTLS limits packet sizes to 16K</li>
<li>Use the mqtt port setting from the config file while setting up the network instance</li>
</ul>
</li>
<li>WebSocket - MQTT over WebSocket. Tested on both Windows (VS 2015) and Linux. Uses OpenSSL 1.1.0 as the underlying TLS layer<ul>
<li>The provided implementation requires OpenSSL to be pre-installed on the device</li>
<li>Please be aware that while the provided reference implementation allows initialization of credentials from any source, the recommended way to do so is to use the aws cli to generate credential files and read the generated files</li>
<li>Use the https port setting from the config file while setting up the network instance</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md72"></a>
Cross-compiling the SDK for other platforms</h2>
<p >The included ToolchainFile.cmake file can be used to cross-compile the SDK for other platforms. Procedure for testing cross compiling (if using OpenSSL):</p>
<ol type="1">
<li>build/download toolchain for specific platform</li>
<li>modify the ToolchainFile.cmake with location and target of toolchain. <div class="fragment"><div class="line"># specify toolchain directory</div>
<div class="line">SET(TOOLCHAIN_DIR /home/toolchain/dir/here/bin)</div>
<div class="line"> </div>
<div class="line"># specify cross compilation target</div>
<div class="line">SET(TARGET_CROSS target-here)`</div>
</div><!-- fragment --></li>
<li>Cross-compile OpenSSL using the same toolchain</li>
<li>modify <code>network/CMakeLists.txt.in</code> and change OpenSSL library location to cross-compiled OpenSSL</li>
</ol>
<p >5. </p><div class="fragment"><div class="line">cd build</div>
<div class="line">cmake ../. -DCMAKE_TOOLCHAIN_FILE=../ToolchainFile.cmake</div>
<div class="line">make</div>
</div><!-- fragment --><ol type="1">
<li>Scp the application binary, certs and config for the application into the platform you're testing</li>
<li>Run <code>./&lt;application&gt;</code></li>
</ol>
<p >For MbedTLS, you don't need to cross-compile MbedTLS as it gets compiled when you run <code>make</code> with the same compiler as pointed to by the toolchain file.</p>
<p >Also included is a simple example 'toolchain' which is used for setting the default compiler as clang++ instead of g++ as an example to show how the toolchain file can be modified.</p>
<p ><a class="anchor" id="quicklinks"></a> </p>
<h1><a class="anchor" id="autotoc_md73"></a>
Quick Links</h1>
<ul>
<li><a href="http://aws-iot-device-sdk-cpp-docs.s3-website-us-east-1.amazonaws.com/v1.4.0/index.html">SDK Documentation</a> - API documentation for the SDK</li>
<li><a class="el" href="md__platform.html">Platform Guide</a> - This file lists the steps needed to set up the pre-requisites on some popular platforms</li>
<li><a class="el" href="md__dev_guide.html">Developers Guide</a> - Provides a guide on how the SDK can be included in custom code</li>
<li><a class="el" href="md__greengrass_discovery.html">Greengrass Discovery Support Guide</a> - Provides information on support for AWS Greengrass Discovery Service</li>
<li>Network Layer Implementation Guide - Detailed description about the Network Layer and how to implement a custom wrapper class</li>
<li>Sample Guide - Details about the included samples</li>
<li>Test Information - Details about the included unit and integration tests</li>
<li><a href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/csprd02/mqtt-v3.1.1-csprd02.html">MQTT 3.1.1 Spec</a> - Link to the MQTT v3.1.1 spec that this SDK implements</li>
</ul>
<p ><a class="anchor" id="sampleapis"></a> </p>
<h1><a class="anchor" id="autotoc_md74"></a>
Sample APIs</h1>
<h2><a class="anchor" id="autotoc_md75"></a>
Sync</h2>
<p >Creating a basic MQTT Client requires a NetworkConnection instance and MQTT Command timeout in milliseconds for any internal blocking operations.</p>
<div class="fragment"><div class="line">std::shared_ptr&lt;NetworkConnection&gt; p_network_connection = &lt;Create Instance&gt;;</div>
<div class="line">std::shared_ptr&lt;MqttClient&gt; p_client = MqttClient::Create(p_network_connection, std::chrono::milliseconds(30000));</div>
</div><!-- fragment --><p >Connecting to the AWS IoT MQTT platform</p>
<div class="fragment"><div class="line">rc = p_client-&gt;Connect(std::chrono::milliseconds(30000), false, mqtt::Version::MQTT_3_1_1, std::chrono::seconds(60), Utf8String::Create(&quot;&lt;client_id&gt;&quot;), nullptr, nullptr, nullptr);</div>
</div><!-- fragment --><p >Subscribe to a topic</p>
<div class="fragment"><div class="line">util::String p_topic_name_str = &lt;topic&gt;;</div>
<div class="line">std::unique_ptr&lt;Utf8String&gt; p_topic_name = Utf8String::Create(p_topic_name_str);</div>
<div class="line">mqtt::Subscription::ApplicationCallbackHandlerPtr p_sub_handler = std::bind(&amp;&lt;handler&gt;, this, std::placeholders::_1, std::placeholders::_2, std::placeholders::_3);</div>
<div class="line">std::shared_ptr&lt;mqtt::Subscription&gt; p_subscription = mqtt::Subscription::Create(std::move(p_topic_name), mqtt::QoS::QOS0, p_sub_handler, nullptr);</div>
<div class="line">util::Vector&lt;std::shared_ptr&lt;mqtt::Subscription&gt;&gt; topic_vector;</div>
<div class="line">topic_vector.push_back(p_subscription);</div>
<div class="line">rc = p_client-&gt;Subscribe(topic_vector, std::chrono::milliseconds(30000));</div>
</div><!-- fragment --><p >Publish to a topic </p><div class="fragment"><div class="line">util::String p_topic_name_str = &lt;topic&gt;;</div>
<div class="line">std::unique_ptr&lt;Utf8String&gt; p_topic_name = Utf8String::Create(p_topic_name_str);</div>
<div class="line">rc = p_client-&gt;Publish(std::move(p_topic_name), false, false, mqtt::QoS::QOS1, payload, std::chrono::milliseconds(30000));</div>
</div><!-- fragment --><p >Unsubscribe from a topic</p>
<div class="fragment"><div class="line">util::String p_topic_name_str = &lt;topic&gt;;</div>
<div class="line">std::unique_ptr&lt;Utf8String&gt; p_topic_name = Utf8String::Create(p_topic_name_str);</div>
<div class="line">util::Vector&lt;std::unique_ptr&lt;Utf8String&gt;&gt; topic_vector;</div>
<div class="line">topic_vector.push_back(std::move(p_topic_name));</div>
<div class="line">rc = p_client-&gt;Subscribe(topic_vector, std::chrono::milliseconds(30000));</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md76"></a>
Async</h2>
<p >Connect is a sync only API in this version of the SDK. Subscribe to a topic</p>
<div class="fragment"><div class="line">uint16_t packet_id_out;</div>
<div class="line">util::String p_topic_name_str = &lt;topic&gt;;</div>
<div class="line">std::unique_ptr&lt;Utf8String&gt; p_topic_name = Utf8String::Create(p_topic_name_str);</div>
<div class="line">mqtt::Subscription::ApplicationCallbackHandlerPtr p_sub_handler = std::bind(&amp;&lt;handler&gt;, this, std::placeholders::_1, std::placeholders::_2, std::placeholders::_3);</div>
<div class="line">std::shared_ptr&lt;mqtt::Subscription&gt; p_subscription = mqtt::Subscription::Create(std::move(p_topic_name), mqtt::QoS::QOS0, p_sub_handler, nullptr);</div>
<div class="line">util::Vector&lt;std::shared_ptr&lt;mqtt::Subscription&gt;&gt; topic_vector;</div>
<div class="line">topic_vector.push_back(p_subscription);</div>
<div class="line">rc = p_client-&gt;SubscribeAsync(topic_vector, nullptr, packet_id_out);</div>
</div><!-- fragment --><p >Publish to a topic </p><div class="fragment"><div class="line">uint16_t packet_id_out;</div>
<div class="line">util::String p_topic_name_str = &lt;topic&gt;;</div>
<div class="line">std::unique_ptr&lt;Utf8String&gt; p_topic_name = Utf8String::Create(p_topic_name_str);</div>
<div class="line">rc = p_client-&gt;PublishAsync(std::move(p_topic_name), false, false, mqtt::QoS::QOS1, payload, packet_id_out);</div>
</div><!-- fragment --><p >Unsubscribe from a topic</p>
<div class="fragment"><div class="line">uint16_t packet_id_out;</div>
<div class="line">util::String p_topic_name_str = &lt;topic&gt;;</div>
<div class="line">std::unique_ptr&lt;Utf8String&gt; p_topic_name = Utf8String::Create(p_topic_name_str);</div>
<div class="line">util::Vector&lt;std::unique_ptr&lt;Utf8String&gt;&gt; topic_vector;</div>
<div class="line">topic_vector.push_back(std::move(p_topic_name));</div>
<div class="line">rc = p_client-&gt;Subscribe(topic_vector, packet_id_out);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md77"></a>
Logging</h2>
<p >To enable logging, create an instance of the ConsoleLogSystem in the main() of your application as shown below:</p>
<div class="fragment"><div class="line">std::shared_ptr&lt;awsiotsdk::util::Logging::ConsoleLogSystem&gt; p_log_system =</div>
<div class="line">    std::make_shared&lt;awsiotsdk::util::Logging::ConsoleLogSystem&gt;(awsiotsdk::util::Logging::LogLevel::Info);</div>
<div class="line">awsiotsdk::util::Logging::InitializeAWSLogging(p_log_system);</div>
</div><!-- fragment --><p >Create a log tag for your application to distinguish it from the SDK logs: </p><div class="fragment"><div class="line">#define LOG_TAG_APPLICATION &quot;[Application]&quot;</div>
</div><!-- fragment --><p >You can now add logging to any part of your application using AWS_LOG_ERROR or AWS_LOG_INFO as shown below:</p>
<div class="fragment"><div class="line">AWS_LOG_ERROR(LOG_TAG_APPLICATION, &quot;Failed to perform action. %s&quot;,</div>
<div class="line">              ResponseHelper::ToString(rc).c_str());</div>
</div><!-- fragment --><p ><a class="anchor" id="license"></a> </p>
<h1><a class="anchor" id="autotoc_md78"></a>
License</h1>
<p >This SDK is distributed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>, see LICENSE and NOTICE.txt for more information.</p>
<p ><a class="anchor" id="support"></a> </p>
<h1><a class="anchor" id="autotoc_md79"></a>
Support</h1>
<p >If you have any technical questions about AWS IoT C++ SDK, use the <a href="https://forums.aws.amazon.com/forum.jspa?forumID=210">AWS IoT forum</a>. For any other questions on AWS IoT, contact <a href="https://aws.amazon.com/contact-us/">AWS Support</a>.</p>
<p >A list of known issues is maintained in <a class="el" href="md__known_issues.html">KnownIssues.md</a>.</p>
<p >Note: customers have <a href="https://github.com/aws/aws-iot-device-sdk-cpp/issues/14">reported deadlocks</a> while using the AWS IoT Device SDK for C++. If you are affected, a fix is available in the <a href="https://github.com/aws/aws-iot-device-sdk-cpp/tree/locking-fixes">locking-fixes</a> branch. This issue is also resolved in the new AWS IoT Device SDK for C++, which is <a href="https://github.com/awslabs/aws-iot-device-sdk-cpp-v2">currently in Developer Preview</a>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
